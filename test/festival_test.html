<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>부산 축제 정보 Carousel 테스트 (호버 Flex 개선)</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .carousel-wrapper {
      position: relative;
      overflow: hidden;
    }
    .festival-list {
      display: flex;
      gap: 20px;
      transition: all 0.3s ease;
    }
    /* 1) 리스트에 마우스가 올라가면 기본 flex:1 */
    .festival-list:hover .festival-item {
      flex: 1;
    }
    .festival-item {
      position: relative;
      flex: 1;                 /* 기본 1:1:1 비율 */
      aspect-ratio: 1 / 2;     /* 세로 1:2 비율 */
      border-radius: 12px;
      overflow: hidden;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      transition: flex 0.3s ease, box-shadow 0.3s ease;
    }
    /* 2) 호버된 카드만 flex:3 으로 확장 */
    .festival-item:hover {
      flex: 3;                
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      z-index: 5;
    }
    .festival-cover {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .festival-info {
      position: absolute;
      bottom: 20px;
      left: 20px;
      right: 20px;
      background: #007bff;
      color: #fff;
      padding: 10px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .festival-title {
      margin: 0;
      font-size: 1.1rem;
      font-weight: bold;
    }
    .festival-dates {
      margin: 0;
      font-size: 0.9rem;
    }
    .festival-details {
      max-height: 0;
      overflow: hidden;
      font-size: 0.8rem;
      line-height: 1.3;
      transition: max-height 0.3s ease;
    }
    .festival-item:hover .festival-details {
      max-height: 100px;
    }
    .arrow-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 36px;
      height: 36px;
      border: none;
      background: rgba(0,0,0,0.5);
      color: #fff;
      font-size: 1.5rem;
      cursor: pointer;
      z-index: 10;
      border-radius: 50%;
    }
    #btn-prev { left: -18px; }
    #btn-next { right: -18px; }
    .arrow-btn:disabled {
      opacity: 0.3;
      cursor: default;
    }
  </style>
</head>
<body>
  <h1>부산 2개월 내 축제 정보</h1>
  <div class="carousel-wrapper">
    <button id="btn-prev" class="arrow-btn" disabled>&larr;</button>
    <div id="festival-list" class="festival-list"></div>
    <button id="btn-next" class="arrow-btn" disabled>&rarr;</button>
  </div>

  <script>
    const listEl = document.getElementById('festival-list');
    const prevBtn = document.getElementById('btn-prev');
    const nextBtn = document.getElementById('btn-next');
    let festivals = [];
    let currentPage = 0;
    const perPage = 3;

    async function loadFestivals() {
      listEl.innerHTML = '<p>불러오는 중…</p>';
      try {
        const res = await fetch('/api/v1/festival');
        if (!res.ok) throw new Error(res.status);
        const data = await res.json();
        festivals = data.items;
        currentPage = 0;
        renderPage();
      } catch (e) {
        listEl.innerHTML = `<p>에러: ${e.message}</p>`;
      }
    }

    function renderPage() {
      const totalPages = Math.ceil(festivals.length / perPage);
      const start = currentPage * perPage;
      const pageItems = festivals.slice(start, start + perPage);

      if (!pageItems.length) {
        listEl.innerHTML = '<p>표시할 축제가 없습니다.</p>';
      } else {
        listEl.innerHTML = pageItems.map(it => `
          <div class="festival-item">
            <img class="festival-cover" src="${it.firstimage || ''}" alt="${it.title}" />
            <div class="festival-info">
              <p class="festival-title">${it.title}</p>
              <p class="festival-dates">
                기간: ${it.eventstartdate.slice(0,4)}.${it.eventstartdate.slice(4,6)}.${it.eventstartdate.slice(6)}
                ${it.eventenddate 
                  ? `~ ${it.eventenddate.slice(0,4)}.${it.eventenddate.slice(4,6)}.${it.eventenddate.slice(6)}` 
                  : ''}
              </p>
              <div class="festival-details">
                <p>장소: ${it.addr1 || ''}${it.addr2 ? ' ' + it.addr2 : ''}</p>
              </div>
            </div>
          </div>
        `).join('');
      }

      prevBtn.disabled = currentPage <= 0;
      nextBtn.disabled = currentPage >= totalPages - 1;
    }

    prevBtn.addEventListener('click', () => {
      if (currentPage > 0) { currentPage--; renderPage(); }
    });
    nextBtn.addEventListener('click', () => {
      const totalPages = Math.ceil(festivals.length / perPage);
      if (currentPage < totalPages - 1) { currentPage++; renderPage(); }
    });

    window.addEventListener('load', loadFestivals);
  </script>
</body>
</html>
